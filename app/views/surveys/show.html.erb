<%= render "shared/header" %>

<%= link_to '戻る',surveys_path,class:'return-btn'%>

<% if Vote.exists?(user_id:current_user.id,vote_id:params[:survey_id])%>
<div class="survey--select-main">

  <div class="survey-select">

    <div class="survey-show-title">
      菊花賞勝つのは？
    </div>


   <% n = 0%><% @number.times do%><% n += 1%>
      <%= form_with model:[@survey,@vote],local: true do |f| %>
          <div class="survey-form">

      <div class = "show-survey-title">
      <%= @survey.send("item#{n}") %>
      </div>

        <div class="show-survey-btn">
          <%= f.hidden_field :select,:value => n %>
          <%= f.submit "投票する" ,class:"select-btn" %>
        </div>
      </div>
        <% end %>
  
    </div>
    <% end %>
  </div>

  <% else %>
<div class="vote-content">
  <div class="chart">
<%= pie_chart @total_vote %>
</div>
<div class="vote-table">

<table border="1" width="500">
  <tr>
  <% n = 0%><% @number.times do %><% n += 1 %>
    <th><%= @survey.send("item#{n}") %></th>
   <%end%>
  </tr>
    <tr>
  <% n = 0%><% @number.times do %><% n += 1 %>
    <th><%= Vote.where(vote_id:@survey.id,select:n).count%></th>
    <% end %>

  </tr>
</table> 
</div>
</div>
<% end %>
